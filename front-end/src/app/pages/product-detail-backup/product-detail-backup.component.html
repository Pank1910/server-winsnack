<div class="flex flex-col">
    <!-- Breadcrumb -->
    <nav
        class="flex flex-wrap gap-3.5 items-center px-20 py-3.5 w-full text-xl bg-[#FFE0C2] min-h-[50px] max-md:px-5 max-md:max-w-full"
        aria-label="Breadcrumb"
    >
        <a
            routerLink="/product-category"
            class="self-stretch my-auto font-medium text-center text-black text-opacity-50 transition duration-300 hover:text-[#FF9413] hover:font-bold"
        >
            T·∫•t c·∫£ s·∫£n ph·∫©m
        </a>
        <img
            loading="lazy"
            src="assets/images/blog/arrow-right.png"
            class="object-contain shrink-0 self-stretch my-auto w-4 aspect-square"
            alt="Breadcrumb arrow"
        />
        <span class="self-stretch my-auto font-bold text-[#FF9413]">
            {{ product.product_name }}
        </span>
    </nav>

    <!-- Main Product Area -->
    <div class="bg-[#FFF8EC] py-8 px-20 max-md:px-5">
        <div class="flex flex-col md:flex-row overflow-hidden mb-8">
            <!-- Product Gallery -->
            <div class="w-full md:w-1/2 p-6">
                <div class="mb-4">
                    <img
                        [src]="product.image_1"
                        [alt]="product.product_name"
                        class="w-full rounded-lg"
                    />
                </div>
                <div class="flex space-x-2">
                    <img *ngFor="let img of [product.image_1, product?.image_1, product?.image_1, product?.image_1 ]"
                        [src]="img" [alt]="product.product_name"
                        class="w-1/4 rounded-md cursor-pointer hover:opacity-100"
                        [ngClass]="{'opacity-100': img === product.image_1, 'opacity-60': img !== product.image_1}" />
                </div>
            </div>

            <!-- Product Details -->
            <div class="w-full md:w-1/2 p-6">
                <h1 class="text-2xl font-bold text-gray-800 mb-2">{{ product.product_name }}</h1>
                <div class="mb-4">
                    <span class="text-2xl font-bold text-[#FF9413] mr-2">
                        {{ getDiscountedPrice() | number }}‚Ç´
                    </span>
                    <span class="text-gray-500 line-through">
                        {{ product.unit_price | number }}‚Ç´
                    </span>
                </div>
                <div class="mb-4">
                    <span class="text-[#FF9413] text-xl">‚òÖ {{ product.rating }}</span>
                    <span class="text-gray-600 ml-2">(67 ƒë√°nh gi√°)</span>
                    <span class="text-gray-600 ml-2">S·∫£n ph·∫©m m·ªõi: {{ product.isNew ? 'C√≥' : 'Kh√¥ng' }}</span>
                </div>
                <div class="mb-4">
                    <p class="text-gray-700 leading-relaxed">{{ product.product_detail }}</p>
                </div>

                <div class="mb-4">
                    <span class="block mb-2">Ch·ªçn ph√¢n lo·∫°i:</span>
                    <div class="flex space-x-3">
                        <button class="px-3 py-1 border rounded-md"
                            [ngClass]="{'bg-[#FF9413] text-white': selectedWeight === 100}"
                            (click)="selectWeight(100)">100g</button>
                        <button class="px-3 py-1 border rounded-md"
                            [ngClass]="{'bg-[#FF9413] text-white': selectedWeight === 200}"
                            (click)="selectWeight(200)">200g</button>
                    </div>
                </div>

                <div class="flex items-center mb-6">
                    <div class="flex items-center border border-[#FF9413] rounded-full overflow-hidden mr-4">
                        <button class="w-12 h-10 text-[#FF9413] bg-white focus:outline-none"
                            (click)="changeQuantity(-1)">-</button>
                        <input type="number" id="quantity" [(ngModel)]="quantity" min="1"
                            class="w-12 h-10 text-center border-none focus:outline-none" />
                        <button class="w-12 h-10 text-[#FF9413] bg-white focus:outline-none"
                            (click)="changeQuantity(1)">+</button>
                    </div>
                    <button
                        class="flex-grow py-2 px-4 bg-[#FF9413] hover:bg-[#e58000] text-white font-semibold rounded-full focus:outline-none"
                        (click)="addToCart()">
                        TH√äM V√ÄO GI·ªé H√ÄNG
                    </button>
                    <!-- Th√¥ng b√°o th√†nh c√¥ng -->
                    <div *ngIf="successMessage" class="fixed top-20 right-5 bg-green-600 text-white p-3 rounded shadow-lg z-50">
                        {{ successMessage }}
                    </div>
                    
                    <!-- Th√¥ng b√°o l·ªói -->
                    <div *ngIf="errorMessage" class="fixed top-20 right-5 bg-red-600 text-white p-3 rounded shadow-lg z-50">
                        {{ errorMessage }}
                    </div>
                </div>

                <!-- Popup -->
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
                    *ngIf="showPopup">
                    <div class="bg-white p-6 rounded-lg shadow-lg max-w-md">
                        <h3 class="text-lg font-semibold mb-2">Th√™m v√†o gi·ªè h√†ng th√†nh c√¥ng!</h3>
                        <p>B·∫°n ƒë√£ th√™m {{ quantity }} g√≥i "{{ product.product_name }}" lo·∫°i {{ selectedWeight }}g v√†o gi·ªè h√†ng.</p>
                        <div class="mt-4 flex justify-center space-x-3">
                            <button class="py-2 px-4 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg"
                                (click)="closePopup()">Ti·∫øp t·ª•c mua s·∫Øm</button>
                            <button class="py-2 px-4 bg-[#FF9413] hover:bg-[#e58000] text-white rounded-lg"
                                (click)="goToCart()">Xem gi·ªè h√†ng</button>
                        </div>
                    </div>
                </div>

                <div class="mt-6">
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="flex items-center p-4">
                            <span class="text-3xl mr-4">üöö</span>
                            <div>
                                <strong>Mi·ªÖn ph√≠ Ship TP.HCM</strong>
                                <p class="text-sm text-gray-600">Trong b√°n k√≠nh 10km n·ªôi th√†nh</p>
                            </div>
                        </div>
                        <div class="h-px bg-gray-200 mx-auto w-11/12"></div>
                        <div class="flex items-center p-4">
                            <span class="text-3xl mr-4">üîÑ</span>
                            <div>
                                <strong>ƒê·ªïi tr·∫£ mi·ªÖn ph√≠</strong>
                                <p class="text-sm text-gray-600">Ho√†n tr·∫£ trong v√≤ng 7 ng√†y</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Description Tab -->
<!-- Product Description & Review Tabs -->
<div class="bg-white rounded-lg shadow-md overflow-hidden">
    <div class="flex border-b">
        <button (click)="setActiveTab('description')"
            [ngClass]="{'text-[#FF9413] border-b-2 border-[#FF9413]': activeTab === 'description'}"
            class="py-3 px-5 font-semibold">
            M√¥ t·∫£
        </button>
        <button (click)="setActiveTab('reviews')"
            [ngClass]="{'text-[#FF9413] border-b-2 border-[#FF9413]': activeTab === 'reviews'}"
            class="py-3 px-5 font-semibold">
            ƒê√°nh gi√°
        </button>
    </div>

    <!-- N·ªôi dung m√¥ t·∫£ s·∫£n ph·∫©m -->
    <div class="p-6" *ngIf="activeTab === 'description'">
        <h2 class="text-xl font-bold mb-3">M√¥ t·∫£ chi ti·∫øt</h2>
        <p>{{ product.product_detail }}</p>

        <!-- C√°ch ƒÉn -->
        <h2 class="text-lg font-semibold mt-4">C√°ch ƒÉn</h2>
        <p>B√°nh tr√°ng s·∫Ω ngon v√† ƒë·∫≠m ƒë√† n·∫øu b·∫°n th∆∞·ªüng th·ª©c ƒë√∫ng c√°ch. C√°ch ƒÉn kh√° ƒë∆°n gi·∫£n, b·∫°n ch·ªâ c·∫ßn:</p>
        <ul class="list-disc pl-6">
            <li><strong>ƒÇn tr·ª±c ti·∫øp:</strong> B√°nh tr√°ng rong bi·ªÉn gi√≤n r·ª•m, ƒë√£ ƒë∆∞·ª£c n√™m n·∫øm gia v·ªã s·∫µn, b·∫°n ch·ªâ c·∫ßn m·ªü g√≥i v√† th∆∞·ªüng th·ª©c ngay. C√°ch ƒÉn n√†y nhanh g·ªçn, ti·ªán l·ª£i khi ƒëang l√†m vi·ªác, xem phim, hay ƒëi d√£ ngo·∫°i.</li>
            <li><strong>Cu·ªôn k√®m rau v√† th·ªãt:</strong> D√πng b√°nh tr√°ng rong bi·ªÉn ƒë·ªÉ cu·ªôn c√πng rau s·ªëng, b√∫n, v√† th·ªãt n∆∞·ªõng ho·∫∑c t√¥m lu·ªôc. Ch·∫•m v·ªõi n∆∞·ªõc m·∫Øm chua ng·ªçt ho·∫∑c s·ªët me ƒë·ªÉ tƒÉng th√™m h∆∞∆°ng v·ªã. C√°ch n√†y gi√∫p b·ªØa ƒÉn th√™m ph·∫ßn s√°ng t·∫°o v√† h·∫•p d·∫´n h∆°n!</li>
        </ul>
        <p class="mt-3">üí° <strong>Win Snack khuy√™n ng∆∞·ªùi d√πng</strong> l∆∞u √Ω b·∫£o qu·∫£n s·∫£n ph·∫©m trong khu v·ª±c kh√¥ r√°o v√† tho√°ng m√°t, tr√°nh ti·∫øp x√∫c tr·ª±c ti·∫øp v·ªõi √°nh n·∫Øng. Th·ªùi h·∫°n s·ª≠ d·ª•ng t·ªëi ƒëa c·ªßa s·∫£n ph·∫©m l√† **7 ng√†y khi ƒë·ªÉ ·ªü ngo√†i** v√† **c√≥ th·ªÉ l√™n ƒë·∫øn 1 th√°ng n·∫øu c·∫•t gi·ªØ trong ngƒÉn m√°t c·ªßa t·ªß l·∫°nh**.</p>

        <!-- Cam k·∫øt -->
        <h2 class="text-lg font-semibold mt-6">Cam k·∫øt</h2>
        <ul class="list-disc pl-6">
            <li>‚úÖ Kh√°ch h√†ng c√≥ th·ªÉ v·ª´a mua tr·ª±c ti·∫øp ho·∫∑c ƒë·∫∑t h√†ng qua h·ªá th·ªëng ƒë·ªÅu ƒë∆∞·ª£c.</li>
            <li>‚úÖ Gi√° th√†nh s·∫£n ph·∫©m ph·∫£i chƒÉng, ni√™m y·∫øt ch√≠nh h√£ng, gi√∫p kh√°ch h√†ng to√†n qu·ªëc y√™n t√¢m mua s·∫Øm.</li>
            <li>‚úÖ Win Snack h·ªó tr·ª£ giao h√†ng **tr√™n to√†n b·ªô 63 t·ªânh th√†nh**, gi√∫p kh√°ch h√†ng c√≥ tr·∫£i nghi·ªám mua s·∫Øm ti·ªán l·ª£i nh·∫•t.</li>
            <li>‚úÖ <strong>Cam k·∫øt h√†ng chu·∫©n</strong> v√† **kh√°ch h√†ng ƒë∆∞·ª£c ƒë·ªïi tr·∫£ s·∫£n ph·∫©m n·∫øu c√≥ l·ªói trong kh√¢u v·∫≠n chuy·ªÉn ho·∫∑c t·ª´ nh√† s·∫£n xu·∫•t**.</li>
            <li>‚úÖ <strong>B√°nh tr√°ng rong bi·ªÉn Win Snack</strong> mang h∆∞∆°ng v·ªã th∆°m ngon, **ƒë∆∞·ª£c nhi·ªÅu b·∫°n tr·∫ª sƒÉn l√πng hi·ªán nay**. Th∆∞·ªüng th·ª©c ngay cho ƒë√£ c√°i n∆∞ n√†o! üòã</li>
        </ul>

        <!-- Th√¥ng tin li√™n h·ªá -->
        <h2 class="text-lg font-semibold mt-6">Th√¥ng tin li√™n h·ªá</h2>
        <ul class="list-disc pl-6">
            <li>üìç <strong>C·ª≠a h√†ng:</strong> 567 ƒë∆∞·ªùng C√°ch M·∫°ng Th√°ng T√°m, Ph∆∞·ªùng 9, Qu·∫≠n 10, TP.HCM</li>
            <li>üè¢ <strong>Kho s·ªâ:</strong> 25/10 Nguy·ªÖn H·ªØu C·∫£nh, Ph∆∞·ªùng 22, Qu·∫≠n B√¨nh Th·∫°nh, TP.HCM</li>
            <li>üìû <strong>Hotline:</strong> <a href="tel:1233-7777" class="text-[#FF9413] font-bold">1233-7777</a></li>
            <li>üåê <strong>Website:</strong> <a href="https://winsnack.vn.com/" class="text-[#FF9413] font-bold">https://winsnack.vn.com/</a></li>
        </ul>
    </div>

    <!-- Ph·∫ßn ƒë√°nh gi√° s·∫£n ph·∫©m -->
    
<!-- Ph·∫ßn ƒë√°nh gi√° s·∫£n ph·∫©m -->
<div class="p-6" *ngIf="activeTab === 'reviews'">
    <h2 class="text-xl font-bold mb-4">ƒê√°nh gi√° s·∫£n ph·∫©m</h2>

    <!-- T·ªïng ƒëi·ªÉm ƒë√°nh gi√° -->
    <div class="overall-rating flex items-center mb-4">
        <span class="rating-value text-4xl font-bold text-[#FF9413]">4.8</span>
        <div class="stars ml-3 text-2xl text-[#FF9413]">
            ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ
        </div>
        <span class="total-reviews ml-3 text-gray-600">(67 ƒë√°nh gi√°)</span>
    </div>

    <!-- Danh s√°ch ƒë√°nh gi√° -->
    <div class="customer-reviews mt-6">
        <div class="review border-b py-4" *ngFor="let review of reviews">
            <div class="review-header flex items-center mb-2">
                <div class="reviewer-name font-bold text-gray-800">{{ review.reviewerName }}</div>
                <div class="review-stars ml-3 text-[#FF9413]">
                    <ng-container *ngFor="let i of createRange(5)">
                        <span *ngIf="i <= review.rating">‚òÖ</span>
                        <span *ngIf="i > review.rating">‚òÜ</span>
                    </ng-container>
                </div>
                <div class="review-date ml-3 text-gray-500 text-sm">{{ review.reviewDate }}</div>
            </div>
            <div class="review-content text-gray-700">
                {{ review.content }}
            </div>
        </div>
    </div>

    <!-- Form vi·∫øt ƒë√°nh gi√° -->
    <div class="review-form-container mt-6">
        <h3 class="text-lg font-bold mb-3">Vi·∫øt ƒë√°nh gi√° c·ªßa b·∫°n</h3>
        <form class="bg-gray-100 p-4 rounded-lg" (submit)="handleReviewSubmit($event)">
            <div class="star-rating mb-3">
                <span class="font-medium">ƒê√°nh gi√° c·ªßa b·∫°n:</span>
                <div class="star-input flex">
                    
                    <input type="radio" name="rating" value="1" id="star1" [(ngModel)]="userRating" [value]="1">
                    <label for="star1" class="text-[#FF9413] text-2xl">‚òÖ</label>
                    
                    <input type="radio" name="rating" value="2" id="star2" [(ngModel)]="userRating" [value]="2">
                    <label for="star2" class="text-[#FF9413] text-2xl">‚òÖ</label>
                    
                    <input type="radio" name="rating" value="3" id="star3" [(ngModel)]="userRating" [value]="3">
                    <label for="star3" class="text-[#FF9413] text-2xl">‚òÖ</label>
                    
                    <input type="radio" name="rating" value="4" id="star4" [(ngModel)]="userRating" [value]="4">
                    <label for="star4" class="text-[#FF9413] text-2xl">‚òÖ</label>

                    <input type="radio" name="rating" value="5" id="star5" [(ngModel)]="userRating" [value]="5">
                    <label for="star5" class="text-[#FF9413] text-2xl">‚òÖ</label>
                </div>
            </div>
            <textarea placeholder="Chia s·∫ª ƒë√°nh gi√° c·ªßa b·∫°n v·ªÅ s·∫£n ph·∫©m"
                class="w-full p-3 rounded-lg border" [(ngModel)]="reviewText" name="reviewText"></textarea>
            <button type="submit" class="mt-3 px-4 py-2 bg-[#FF9413] text-white rounded-lg">
                G·ª≠i ƒë√°nh gi√°
            </button>
        </form>
    </div>
</div>
<!-- Popup x√°c nh·∫≠n g·ª≠i ƒë√°nh gi√° -->
<div *ngIf="showReviewConfirmPopup" class="fixed inset-0 flex items-center justify-center z-50">
    <div class="fixed inset-0 bg-black opacity-50"></div>
    <div class="bg-white rounded-lg p-6 shadow-xl z-10 max-w-md w-full">
        <h3 class="text-xl font-bold mb-4 text-gray-800">X√°c nh·∫≠n g·ª≠i ƒë√°nh gi√°</h3>
        <p class="mb-4 text-gray-700">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën g·ª≠i ƒë√°nh gi√° n√†y?</p>
        <div class="review-preview bg-gray-100 p-3 rounded-lg mb-4">
            <div class="flex items-center mb-2">
                <span class="text-[#FF9413]">
                    <ng-container *ngFor="let i of createRange(5)">
                        <span *ngIf="i <= userRating">‚òÖ</span>
                        <span *ngIf="i > userRating">‚òÜ</span>
                    </ng-container>
                </span>
            </div>
            <p class="text-gray-700">{{ reviewText }}</p>
        </div>
        <div class="flex justify-end space-x-3">
            <button (click)="cancelReview()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                H·ªßy b·ªè
            </button>
            <button (click)="confirmReview()" class="px-4 py-2 bg-[#FF9413] text-white rounded-lg hover:bg-orange-600">
                X√°c nh·∫≠n
            </button>
        </div>
    </div>
</div>

<!-- Popup th√¥ng b√°o ƒë√°nh gi√° th√†nh c√¥ng -->
<div *ngIf="showReviewSuccessPopup" class="fixed inset-0 flex items-center justify-center z-50">
    <div class="fixed inset-0 bg-black opacity-50"></div>
    <div class="bg-white rounded-lg p-6 shadow-xl z-10 max-w-md w-full text-center">
        <div class="text-green-500 text-5xl mb-4">
            <span>‚úì</span>
        </div>
        <h3 class="text-xl font-bold mb-2 text-gray-800">C·∫£m ∆°n b·∫°n!</h3>
        <p class="mb-6 text-gray-700">ƒê√°nh gi√° c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng!</p>
        <button (click)="closeReviewSuccessPopup()" 
                class="px-6 py-2 bg-[#FF9413] text-white rounded-lg hover:bg-orange-600">
            ƒê√≥ng
        </button>
    </div>
</div>

<!-- Popup th√¥ng b√°o c·∫ßn ch·ªçn rating -->
<div *ngIf="showRatingRequiredPopup" class="fixed inset-0 flex items-center justify-center z-50">
    <div class="fixed inset-0 bg-black opacity-50"></div>
    <div class="bg-white rounded-lg p-6 shadow-xl z-10 max-w-md w-full text-center">
        <div class="text-red-500 text-5xl mb-4">
            <span>!</span>
        </div>
        <h3 class="text-xl font-bold mb-2 text-gray-800">Thi·∫øu th√¥ng tin</h3>
        <p class="mb-6 text-gray-700">Vui l√≤ng ch·ªçn s·ªë sao ƒë√°nh gi√° cho s·∫£n ph·∫©m!</p>
        <button (click)="closeRatingRequiredPopup()" 
                class="px-6 py-2 bg-[#FF9413] text-white rounded-lg hover:bg-orange-600">
            ƒê√≥ng
        </button>
    </div>
</div>

    </div>
</div>


